<template>
    <div class="multi-select" onclick={stopPropagation}>
        <label class="slds-form-element__label">
            <abbr class="slds-required" if:true={required} title="required">*</abbr>
            {label}
            <lightning-spinner
                    alternative-text="Loading"
                    class="slds-m-left_x-small slds-spinner_inline"
                    lwc:if={showSpinner}
                    size="xx-small"
            ></lightning-spinner>
        </label>

        <!-- Pills only in multi-select mode -->
        <template if:true={isMultiSelect}>
            <div class="selected-items">
                <template for:each={selectedOptions} for:item="option">
          <span class="pill" key={option.value}>
            {option.label}
            <button class="remove" data-value={option.value} onclick={handleRemove}>Ã—</button>
          </span>
                </template>
            </div>
        </template>

        <template lwc:if={hasOptions}>
            <div class="combo-input-container">
                <input
                        class="search-input"
                        data-id="search-input"
                        onclick={openDropdown}
                        oninput={handleInput}
                        placeholder="Search and select"
                        type="text"
                        value={computedInputValue}
                />

                <lightning-icon
                        class="dropdown-icon"
                        icon-name="utility:down"
                        onclick={toggleDropdown}
                        size="x-small"
                ></lightning-icon>
            </div>

            <ul lwc:if={showDropdown} class="dropdown">
                <template for:each={filteredOptions} for:item="option">
                    <li
                            class="dropdown-item"
                            data-label={option.label}
                            data-value={option.value}
                            key={option.uniqueKey}
                            onclick={handleSelect}
                    >
                        {option.label}
                    </li>
                </template>
            </ul>
        </template>


        <template if:false={hasOptions}>
            <div class="slds-box slds-box_x-small slds-theme_shade">
                <p class="slds-text-color_weak">No fields are available.</p>
            </div>
        </template>
    </div>
</template>